<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
      rel="stylesheet"
    />
    <title>AI問診</title>
  </head>

  <body data-page="message" class="bg-tertiary-50">
    <svg style="display: none"><%- include('./layout/icons'); -%></svg> <%-
    include('./layout/header'); -%>

    <section class="">
      <div class="d-flex gap-3 flex-column">
        <!-- 修改編輯區域 -->

        <!-- 1:上方：標題列 -->
        <div class="top-bar pt-14">
          <!-- 左：返回箭頭 -->
          <!-- <button class="icon-btn" type="button" aria-label="返回">←</button> -->

          <!-- 中：掛號 / AI 問診 / 聲音模式 -->
          <div class="text-center">
            <div class="zh-h2 mb-3">AI 問診</div>
            <!-- 加上 id="modeTag" 給 JS 用 -->
            <span class="pill-tag zh-h5" id="modeTag">聲音模式</span>
          </div>
        </div>

        <!-- 2:中間內容：常見症狀 + 波形 + 引導文字 + 對話 -->
        <div class="chat-area-wrapper">
          <!-- 常見標籤 -->
          <div class="quick-tags-header">
            <span class="quick-tags-title zh-text-m">常見症狀</span>
          </div>

          <div class="quick-tags">
            <button class="quick-tag-btn" data-text="身體沒力">
              <span class="quick-tag-text zh-h5">身體沒力</span>
              <svg class="tag-icon"><use href="#icon-arrow"></use></svg>
            </button>

            <button class="quick-tag-btn" data-text="膝蓋痛">
              <span class="quick-tag-text zh-h5">膝蓋痛</span>
              <svg class="tag-icon"><use href="#icon-arrow"></use></svg>
            </button>

            <button class="quick-tag-btn" data-text="看不清楚">
              <span class="quick-tag-text zh-h5">看不清楚</span>
              <svg class="tag-icon"><use href="#icon-arrow"></use></svg>
            </button>

            <button class="quick-tag-btn" data-text="頻尿">
              <span class="quick-tag-text zh-h5">頻尿</span>
              <svg class="tag-icon"><use href="#icon-arrow"></use></svg>
            </button>

            <button class="quick-tag-btn" data-text="血壓高">
              <span class="quick-tag-text zh-h5">血壓高</span>
              <svg class="tag-icon"><use href="#icon-arrow"></use></svg>
            </button>
          </div>

          <!-- 常見標籤-完 -->

          <div class="listening-top-block">
            <!-- 說明文字（上方預覽文字會寫在這裡） -->
            <div class="status-text-center" id="statusText">
              請說出哪裡不舒服。
            </div>

            <!-- 動態波new -->
            <div class="sound-wave" id="soundWave">
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
            </div>
            <!-- 動態波new -->
          </div>

          <!-- 對話區（先有一則歡迎訊息） -->
          <div id="chatScroller" class="chat-scroller">
            <div class="chat-bubble-row">
              <div>
                <div class="chat-bubble bubble-ai">
                  您好，我是 AI
                  問診小幫手。您可以直接說出現在哪裡不舒服，我會先幫您分析，提供較合適的看診科別參考。
                </div>
                <div class="chat-time">
                  <span id="welcomeTime"></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 3:下方：麥克風 + 左右按鈕 + 使用提示 -->
        <!-- 3:下方：麥克風 + 左右按鈕 + 使用提示 -->
        <div class="bottom-bar fixed-bottom-bar">
          <!-- 中間大顆麥克風 -->
          <button id="micBtn" class="mic-main-btn" type="button">
            <!-- 麥克風 SVG（預設顯示） -->
            <svg id="micIconMic" class="mic-icon" width="48" height="48">
              <use href="#icon-mic"></use>
            </svg>

            <!-- 停止 SVG（不用也可 hidden） -->
            <svg
              id="micIconStop"
              class="mic-icon hidden"
              width="48"
              height="48"
            >
              <rect x="12" y="12" width="24" height="24" rx="4" fill="white" />
            </svg>

            <!-- 方形 ■ -->
            <div id="micSquare" class="mic-square hidden"></div>
          </button>
          <!-- 底部一排：退出｜提示文字｜傳送 -->
          <div
            class="bottom-row d-flex justify-content-between align-items-center mt-4"
          >
            <!-- 左：退出 -->
            <button
              id="resetBtn"
              class="bottom-icon-btn text-center"
              type="button"
              disabled
            >
              <div class="bottom-icon">🗑</div>
              <div class="bottom-icon-label">退出</div>
            </button>

            <!-- 中：會被 JS 更新的文字 -->
            <div id="recordHint" class="bottom-text text-center zh-h4">
              點擊即可說話
            </div>

            <!-- 右：傳送 -->
            <button
              id="sendBtn"
              class="bottom-icon-btn text-center"
              type="button"
              disabled
            >
              <div class="bottom-icon">📤</div>
              <div class="bottom-icon-label">傳送</div>
            </button>

            <!-- 靜音控制（隱藏） -->
            <button id="muteBtn" class="d-none" type="button">
              關閉 / 開啟語音播報
            </button>
          </div>

          <!-- 使用說明框，可按 X 關閉 -->
          <div id="usageTip" class="usage-tip mt-2">
            <div class="usage-tip-text flex-grow-1">
              哪裡不舒服？跟 AI
              管家說話，它會聽懂您的狀況，幫您找到對應科別和醫生。
            </div>
            <button
              id="closeTipBtn"
              class="usage-tip-close"
              type="button"
              aria-label="關閉提示"
            >
              ✕
            </button>
          </div>
        </div>

        <!-- 區域結束 -->
      </div>
    </section>

    <!-- <%- include('./layout/footer'); -%> -->
    <script type="module" src="../main.js"></script>
    <!-- 自己的 JS 檔 -->
    <script src="../assets/js/ai-triage.js"></script>
  </body>
</html>
